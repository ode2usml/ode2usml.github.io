<!DOCTYPE html>
<html>
  <head>
    <meta charset="UTF-8">
    <title>My GitHub Pages Video</title>
    <script>
      document.addEventListener('DOMContentLoaded', function () {
        // 🔐 Passphrase Protection
        const correctPassphrase = "comrades"; // Set your passphrase here
        const userInput = prompt("Enter passphrase to access this page:");

        if (userInput !== correctPassphrase) {
          alert("Incorrect passphrase. Redirecting...");
          window.location.href = "https://google.com";
          return;
        }

        // 🎥 Video Play Detection
        const video = document.getElementById('myVideo');
        let hasPlayed = false;

        video.addEventListener('play', function () {
          if (!hasPlayed) {
            hasPlayed = true;
            notifyPlayEvent();
          }
        });

        // 🌐 Notify via IFTTT including IP, location, and device info
        function notifyPlayEvent() {
          const userAgent = navigator.userAgent;

          fetch("https://ipapi.co/json/")
            .then(response => response.json())
            .then(data => {
              const ip = data.ip || "Unknown";
              const city = data.city || "Unknown";
              const region = data.region || "Unknown";
              const country = data.country || "Unknown";

              const message = `Video played!
IP: ${ip}
Location: ${city}, ${region}, ${country}
Device: ${userAgent}`;

              fetch("https://maker.ifttt.com/trigger/video_played/with/key/d2_s_jC9bzjrP4p9VKPeQ0", {
                method: "POST",
                headers: { "Content-Type": "application/json" },
                body: JSON.stringify({
                  value1: message,
                  time: new Date().toISOString()
                })
              });
            })
            .catch(error => {
              console.error("Failed to fetch IP info:", error);
            });
        }
      });
    </script>
  </head>
  <body>
    <h1>Hello World</h1>
    <p>I'm hosted with GitHub Pages.</p>

    <!-- Video -->
    <video id="myVideo" width="640" controls>
      <source src="assets/video.mp4" type="video/mp4">
      Your browser does not support the video tag.
    </video>
  </body>
</html>
